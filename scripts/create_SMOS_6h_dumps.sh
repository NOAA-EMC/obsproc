#!/bin/bash

#ll $DCOMROOT/20231023/wtxtbul/satSSS/SMOS/SM*
#-rw-rw-r-- 1 dfprod prod 6180907 Oct 23 09:35 /lfs/h1/ops/prod/dcom/20231023/wtxtbul/satSSS/SMOS/SM_OPER_MIR_OSUDP2_20231023T002549_20231023T011909_700_001_1.nc
#-rw-rw-r-- 1 dfprod prod 7568401 Oct 23 09:35 /lfs/h1/ops/prod/dcom/20231023/wtxtbul/satSSS/SMOS/SM_OPER_MIR_OSUDP2_20231023T011558_20231023T020911_700_001_1.nc
#-rw-rw-r-- 1 dfprod prod 6011948 Oct 23 10:35 /lfs/h1/ops/prod/dcom/20231023/wtxtbul/satSSS/SMOS/SM_OPER_MIR_OSUDP2_20231023T020554_20231023T025913_700_001_1.nc
#-rw-rw-r-- 1 dfprod prod 8859539 Oct 23 11:35 /lfs/h1/ops/prod/dcom/20231023/wtxtbul/satSSS/SMOS/SM_OPER_MIR_OSUDP2_20231023T025602_20231023T034915_700_001_1.nc
#-rw-rw-r-- 1 dfprod prod 4039757 Oct 23 12:35 /lfs/h1/ops/prod/dcom/20231023/wtxtbul/satSSS/SMOS/SM_OPER_MIR_OSUDP2_20231023T034558_20231023T043917_700_001_1.nc
#-rw-rw-r-- 1 dfprod prod 9395505 Oct 23 13:35 /lfs/h1/ops/prod/dcom/20231023/wtxtbul/satSSS/SMOS/SM_OPER_MIR_OSUDP2_20231023T043605_20231023T052920_700_001_1.nc
#-rw-rw-r-- 1 dfprod prod 6643511 Oct 23 14:35 /lfs/h1/ops/prod/dcom/20231023/wtxtbul/satSSS/SMOS/SM_OPER_MIR_OSUDP2_20231023T052603_20231023T061922_700_001_1.nc
#-rw-rw-r-- 1 dfprod prod 9525958 Oct 23 14:35 /lfs/h1/ops/prod/dcom/20231023/wtxtbul/satSSS/SMOS/SM_OPER_MIR_OSUDP2_20231023T061610_20231023T070925_700_001_1.nc
#-rw-rw-r-- 1 dfprod prod 9515306 Oct 23 16:35 /lfs/h1/ops/prod/dcom/20231023/wtxtbul/satSSS/SMOS/SM_OPER_MIR_OSUDP2_20231023T070607_20231023T075926_700_001_1.nc
#-rw-rw-r-- 1 dfprod prod 7496393 Oct 23 16:35 /lfs/h1/ops/prod/dcom/20231023/wtxtbul/satSSS/SMOS/SM_OPER_MIR_OSUDP2_20231023T075616_20231023T084928_700_001_1.nc
#-rw-rw-r-- 1 dfprod prod 7264072 Oct 23 17:35 /lfs/h1/ops/prod/dcom/20231023/wtxtbul/satSSS/SMOS/SM_OPER_MIR_OSUDP2_20231023T084610_20231023T093931_700_001_1.nc
#-rw-rw-r-- 1 dfprod prod 5880167 Oct 23 17:35 /lfs/h1/ops/prod/dcom/20231023/wtxtbul/satSSS/SMOS/SM_OPER_MIR_OSUDP2_20231023T093619_20231023T102933_700_001_1.nc
#-rw-rw-r-- 1 dfprod prod 5028971 Oct 23 19:35 /lfs/h1/ops/prod/dcom/20231023/wtxtbul/satSSS/SMOS/SM_OPER_MIR_OSUDP2_20231023T102616_20231023T111936_700_001_1.nc
#-rw-rw-r-- 1 dfprod prod 6034087 Oct 23 19:35 /lfs/h1/ops/prod/dcom/20231023/wtxtbul/satSSS/SMOS/SM_OPER_MIR_OSUDP2_20231023T111622_20231023T120938_700_001_1.nc
#-rw-rw-r-- 1 dfprod prod 6989882 Oct 23 21:35 /lfs/h1/ops/prod/dcom/20231023/wtxtbul/satSSS/SMOS/SM_OPER_MIR_OSUDP2_20231023T120620_20231023T125939_700_001_1.nc
#-rw-rw-r-- 1 dfprod prod 6166808 Oct 23 21:35 /lfs/h1/ops/prod/dcom/20231023/wtxtbul/satSSS/SMOS/SM_OPER_MIR_OSUDP2_20231023T125630_20231023T134942_700_001_1.nc
#-rw-rw-r-- 1 dfprod prod 9432625 Oct 23 21:35 /lfs/h1/ops/prod/dcom/20231023/wtxtbul/satSSS/SMOS/SM_OPER_MIR_OSUDP2_20231023T134624_20231023T143944_700_001_1.nc
#-rw-rw-r-- 1 dfprod prod 5391889 Oct 23 22:35 /lfs/h1/ops/prod/dcom/20231023/wtxtbul/satSSS/SMOS/SM_OPER_MIR_OSUDP2_20231023T143632_20231023T152947_700_001_1.nc
#-rw-rw-r-- 1 dfprod prod 9922064 Oct 23 23:35 /lfs/h1/ops/prod/dcom/20231023/wtxtbul/satSSS/SMOS/SM_OPER_MIR_OSUDP2_20231023T152630_20231023T161949_700_001_1.nc
#-rw-rw-r-- 1 dfprod prod 4663471 Oct 24 00:35 /lfs/h1/ops/prod/dcom/20231023/wtxtbul/satSSS/SMOS/SM_OPER_MIR_OSUDP2_20231023T161638_20231023T170952_700_001_1.nc
#-rw-rw-r-- 1 dfprod prod 9560455 Oct 24 02:35 /lfs/h1/ops/prod/dcom/20231023/wtxtbul/satSSS/SMOS/SM_OPER_MIR_OSUDP2_20231023T170636_20231023T175954_700_001_1.nc
#-rw-rw-r-- 1 dfprod prod 6588325 Oct 24 02:35 /lfs/h1/ops/prod/dcom/20231023/wtxtbul/satSSS/SMOS/SM_OPER_MIR_OSUDP2_20231023T175644_20231023T184955_700_001_1.nc
#-rw-rw-r-- 1 dfprod prod 8785774 Oct 24 03:35 /lfs/h1/ops/prod/dcom/20231023/wtxtbul/satSSS/SMOS/SM_OPER_MIR_OSUDP2_20231023T184638_20231023T193958_700_001_1.nc
#-rw-rw-r-- 1 dfprod prod 8723366 Oct 24 03:35 /lfs/h1/ops/prod/dcom/20231023/wtxtbul/satSSS/SMOS/SM_OPER_MIR_OSUDP2_20231023T193647_20231023T203000_700_001_1.nc
#-rw-rw-r-- 1 dfprod prod 5594289 Oct 24 07:35 /lfs/h1/ops/prod/dcom/20231023/wtxtbul/satSSS/SMOS/SM_OPER_MIR_OSUDP2_20231023T202643_20231023T212003_700_001_1.nc
#-rw-rw-r-- 1 dfprod prod 6536424 Oct 24 07:35 /lfs/h1/ops/prod/dcom/20231023/wtxtbul/satSSS/SMOS/SM_OPER_MIR_OSUDP2_20231023T211652_20231023T221005_700_001_1.nc
#-rw-rw-r-- 1 dfprod prod 5321261 Oct 24 07:35 /lfs/h1/ops/prod/dcom/20231023/wtxtbul/satSSS/SMOS/SM_OPER_MIR_OSUDP2_20231023T220647_20231023T230008_700_001_1.nc
#-rw-rw-r-- 1 dfprod prod 8468337 Oct 24 07:35 /lfs/h1/ops/prod/dcom/20231023/wtxtbul/satSSS/SMOS/SM_OPER_MIR_OSUDP2_20231023T225655_20231023T235009_700_001_1.nc
#-rw-rw-r-- 1 dfprod prod 6300840 Oct 24 08:35 /lfs/h1/ops/prod/dcom/20231023/wtxtbul/satSSS/SMOS/SM_OPER_MIR_OSUDP2_20231023T234652_20231024T004011_700_001_1.nc
#
# OBSERVATIONS
# files arrive/are completed/ 8-9h after the filename time

export Din=$DCOMROOT #/20231023/wtxtbul/satSSS/SMOS/SM*
#export Dout=/lfs/h2/emc/obsproc/noscrub/iliana.genkova/MARINE_code/
export Dout=/lfs/h2/emc/obsproc/noscrub/iliana.genkova/CRON/SOCA/com/obsproc/v1.2  #gfs.20231026/00/atmos/

#for cron
cdate=`date +\%Y\%m\%d`
cdatem1=`date -d "$cdate -1 day" +%Y%m%d`
cyc=`date --date="-9 hours" +\%H` #cron runing at 9UTC  will process 00UTC cycle

#for testing
#cdate=20231120
#cdatem1=20231119
#cyc=12

echo 'cdate and cdatem1 : ' $cdate $cdatem1
echo 'cyc : ' $cyc

if [[ $cyc == '18' ]]; then # 9h latency puts us into the next day
        cdate=`date -d "$cdate -1 day" +%Y%m%d`
        cdatem1=`date -d "$cdate -2 day" +%Y%m%d`
fi

#for cyc in 00 06 12 18; do # use this in retro/catchup processing
mkdir -p $Dout/gdas.$cdate/$cyc/sss
cycdatem3h=`date -d "$cdate $cyc 3 hours ago" +%Y%m%d%H`
cycdatep3h=`date -d "$cdate $cyc +3 hours" +%Y%m%d%H`
echo $cycdatem3h $cycdatep3h
if [[ $cyc == '00' ]]; then
   lofm3=`ls $Din/${cdatem1}/wtxtbul/satSSS/SMOS/SM_*`
   for filem1 in $lofm3; do
       sdatem1=`echo $filem1 | cut -d'_' -f5` # ???or maybe -f6 is better?
       yyyymmddHMm1=${sdatem1:0:8}${sdatem1:9:2}${sdatem1:11:2}
       if [[ $yyyymmddHMm1 -ge $cycdatem3h'00' ]]; then
          cp $filem1 $Dout/gdas.$cdate/$cyc/sss
       fi
   done
   lof=`ls $Din/${cdate}/wtxtbul/satSSS/SMOS/SM_*`
   for file in $lof; do
    sdate=`echo $file | cut -d'_' -f5`
    yyyymmddHM=${sdate:0:8}${sdate:9:2}${sdate:11:2}
    if [[ $yyyymmddHM -le $cycdatep3h'00' ]]; then
       cp $file $Dout/gdas.$cdate/$cyc/sss
    fi
   done
else
   echo 'CYCLE IS ' ${cyc}
   lof=`ls $Din/${cdate}/wtxtbul/satSSS/SMOS/SM_*`
   echo ${lof}
   for file in $lof; do
       sdate=`echo $file | cut -d'_' -f5`
       echo 'sdate is ' $sdate
       yyyymmddHM=${sdate:0:8}${sdate:9:2}${sdate:11:2}
       echo 'yyyymmddHM is ' ${yyyymmddHM}
       echo 'cycdatem3h is ' ${cycdatem3h}
       echo 'cycdatep3h is ' ${cycdatep3h}
       if [[ $yyyymmddHM -ge $cycdatem3h'00' && $yyyymmddHM -le $cycdatep3h'00' ]]; then
          cp $file $Dout/gdas.$cdate/$cyc/sss
       fi
   done
fi #cyc
echo ' '
echo cycle $cyc DONE
echo ' '
#done #cyc
